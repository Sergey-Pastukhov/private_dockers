name: Build and publish all images in repo

on: [push]

jobs:
  push_to_registry:
    name: Push Docker image to Docker Hub
    runs-on: ubuntu-latest
    env:
      LOGIN: ${{ secrets.DOCKERHUB_LOGIN }}
      NAME: alpine-cmake
    steps:
      - name: Check out the repo
        uses: actions/checkout@v2
      - name: Login to https://hub.docker.com/
        run:  echo ${{ secrets.DOCKERHUB_PASS }} | docker login -u ${{ secrets.DOCKERHUB_LOGIN }} --password-stdin
      - name: Build image
        run: docker build -t $LOGIN/$NAME:test -f alpine-cmake/Dockerfile .
      - name: Push image to docker.io
        run: docker push $LOGIN/$NAME:test
      # - name: Build-Push alpine-cmake
      #   uses: docker/build-push-action@v2
      #   with:
      #     username: ${{ secrets.DOCKERHUB_LOGIN }}
      #     password: ${{ secrets.DOCKERHUB_PASS }}
      #     repository: proffarnsw/alpine-cmake
      #     dockerfile: alpine-cmake/Dockerfile
      #     tag_with_ref: true
      # - name: Build-Push alpine-cmake-doxygen
      #   uses: docker/build-push-action@v2
      #   with:
      #     username: ${{ secrets.DOCKERHUB_LOGIN }}
      #     password: ${{ secrets.DOCKERHUB_PASS }}
      #     repository: proffarnsw/alpine-cmake-doxygen
      #     dockerfile: alpine-cmake-doxygen/Dockerfile
      #     tag_with_ref: true
